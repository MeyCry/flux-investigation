// Generated by CoffeeScript 1.9.1
(function() {
  var AppDispatcher, Dispatcher, Promise, _addPromise, _callbacks, _clearPromises, _promises;

  Promise = require("es6-promise").Promise;

  _callbacks = [];

  _promises = [];

  _addPromise = function(callback, payload) {
    return _promises.push(new Promise(function(resolve, reject) {
      if (callback(payload)) {
        return resolve(payload);
      } else {
        return reject(new Error("Dispatcher callback unsuccessful"));
      }
    }));
  };

  _clearPromises = function() {
    return _promises = [];
  };

  Dispatcher = function() {};

  Dispatcher.prototype.register = function(callback) {
    _callbacks.push(callback);
    return _callbacks.length - 1;
  };

  Dispatcher.prototype.dispatch = function(payload) {
    _callbacks.forEach(function(callback) {
      return _addPromise(callback, payload);
    });
    return Promise.all(_promises).then(_clearPromises);
  };

  Dispatcher.prototype.handleViewAction = function(action) {
    return this.dispatch({
      source: "VIEW_ACTION",
      action: action
    });
  };

  AppDispatcher = new Dispatcher;

  module.exports = AppDispatcher;

}).call(this);
